<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title id="page-title">Sonia's Blog</title>
    <link rel="icon" href="/images/icons/heart3.png" />
    <link rel="stylesheet" href="../../styles/blogs.css">
    <link rel="stylesheet" href="../../styles/stylesheet.css">
    <link rel="stylesheet" href="blog.css">
    <!-- Markdown parser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
</head>
<body>
<nav class="navigation">
    <a href="../../index.html" class="nav-item">HOME</a>
    <a href="../../misc/resources.html" class="nav-item">RESOURCES</a>
    <a href="../../navigation/portfolio.html" class="nav-item">PORTFOLIO</a>
    <a href="../tutorials.html" class="nav-item">ABOUT</a>
    <a href="../../navigation/contact.html" class="nav-item">CONTACT</a>
</nav>

<div class="title-container">
    <div class="nav-links">
        <a href="../../index.html" class="sub-nav-item">SEE: </a>
        <a href="../../personal/music.html" class="sub-nav-item">music</a>
        <a href="../../personal/movies.html" class="sub-nav-item">movies</a>
        <a href="../../personal/books.html" class="sub-nav-item">books</a>
        <a href="../../personal/cards.html" class="sub-nav-item">cards</a>
    </div>
</div>

<div class="content">
    <!-- Sidebar -->
    <div class="blog-sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">Navigation</h3>
            <a href="../blogs.html" class="sidebar-link">All Posts</a>
        </div>

        <div class="sidebar-section">
            <h3 class="sidebar-title">Highlights</h3>
            <a href="entry.html?post=archive" class="sidebar-link">Digital Hoarding</a>
            <a href="entry.html?post=loss" class="sidebar-link">Letting Go</a>
            <a href="entry.html?post=notes" class="sidebar-link">Excerpts from my Notes App</a>
        </div>
    </div>

    <div class="blog-content">
        <div class="blog-header">
            <h1 class="blog-title" id="blog-title">Loading...</h1>
            <div class="blog-post-meta" id="blog-meta"></div>
        </div>

        <div id="blog-body" class="blog-body">
            <p>Loading post...</p>
        </div>
    </div>
</div>

<script>
    // Wait for animate function to be available
    function waitForAnimate() {
        if (typeof animate === 'function') {
            animate();
        } else {
            setTimeout(waitForAnimate, 100);
        }
    }

    waitForAnimate();

    // Get the post parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('post');
    if (!postId) {
        document.getElementById('blog-title').textContent = 'No Post Selected';
        document.getElementById('blog-body').innerHTML = '<p>Please select a post from the <a href="../blogs.html">blog list</a>.</p>';
    } else {
        loadPost(postId);
    }

    // Load the markdown file
    async function loadPost(postId) {
        try {
            const response = await fetch(`${postId}.md`);
            if (!response.ok) {
                throw new Error('Post not found');
            }

            const markdown = await response.text();

            // Parse frontmatter (metadata at the top of markdown file)
            const { frontmatter, content } = parseFrontmatter(markdown);

            // Update page title and metadata
            document.getElementById('page-title').textContent = frontmatter.title + " - Sonia's Blog";
            document.getElementById('blog-title').textContent = frontmatter.title;
            document.getElementById('blog-meta').textContent = `${frontmatter.date} â€¢ ${frontmatter.readTime || '5 min read'}`;

            // Convert markdown to HTML and display
            const html = marked.parse(content);
            document.getElementById('blog-body').innerHTML = html;

        } catch (error) {
            console.error('Error loading post:', error);
            document.getElementById('blog-title').textContent = 'Post Not Found';
            document.getElementById('blog-meta').textContent = '';
            document.getElementById('blog-body').innerHTML = '<p>Sorry, this blog post could not be loaded.</p>';
        }
    }

    // Parse frontmatter from markdown
    function parseFrontmatter(markdown) {
        const frontmatterRegex = /^---\n([\s\S]*?)\n---\n([\s\S]*)$/;
        const match = markdown.match(frontmatterRegex);

        if (!match) {
            return {
                frontmatter: {},
                content: markdown
            };
        }

        const frontmatterText = match[1];
        const content = match[2];

        // Parse YAML-style frontmatter
        const frontmatter = {};
        frontmatterText.split('\n').forEach(line => {
            const [key, ...valueParts] = line.split(':');
            if (key && valueParts.length > 0) {
                frontmatter[key.trim()] = valueParts.join(':').trim();
            }
        });

        return { frontmatter, content };
    }

    // Load the post when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => loadPost(postId));
    } else {
        loadPost(postId);
    }
</script>

<footer>
    <p>
        <a href="https://github.com/sonia-sharapova">GitHub</a> |
        <a href="https://www.linkedin.com/in/sonia-sharapova/">LinkedIn</a> |
        <a href="https://www.instagram.com/sonia.s.ru/">Instagram</a>
    </p>
    <div>
        Contact Links<br>
        2025
    </div>
</footer>

</body>
</html>